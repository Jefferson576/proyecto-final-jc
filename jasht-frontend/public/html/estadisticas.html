<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas Personales - JASHT</title>
    <link rel="stylesheet" href="../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header class="main-header">
        <div class="header-inner">
            <div class="logo">
                <img src="../img/logo.png" alt="Logo" width="60" height="60" />
            </div>
            <h1>JASHT STORE</h1>
        </div>
        <input type="checkbox" id="menu-toggle" class="menu-toggle" aria-label="Abrir menú">
        <label for="menu-toggle" class="hamburger" aria-label="Abrir menú">&#9776;</label>
        <nav class="menu">
            <a href="/index.html">Inicio</a>
            <a href="/html/insertar.html" id="add-link" style="display:none;">Agregar juego</a>
            <a href="/html/estadisticas.html">Estadísticas</a>
            <a id="admin-add" href="/html/insertar.html" style="display:none;">Agregar para todos</a>
            <div class="menu-meta">
                <div id="user-info" class="user-info"></div>
                <button id="logout-btn">Cerrar sesión</button>
            </div>
        </nav>
    </header>
    <main class="page-wrap">
        <section class="estadisticas-container">
            <a class="btn-volver" href="/index.html">← Volver</a>
            <div class="stats-totales">
                <h2>Resumen general</h2>
                <p>
                    <strong>Total de juegos:</strong>
                    <span id="total-juegos">0</span>
                </p>
                <p>
                    <strong>Promedio de calificación:</strong>
                    <span id="promedio-rating">0</span>
                    /5
                </p>
            </div>
            <div class="graficos">
                <div class="grafico">
                    <h3>Juegos por categoría</h3>
                    <canvas id="graficoCategorias"></canvas>
                </div>
            </div>
        </section>
    </main>
    <script src="/js/common.js"></script>
    <script src="/js/estadisticas.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var token = localStorage.getItem('token');
            var ui = document.getElementById('user-info');
            var lb = document.getElementById('logout-btn');
            var adminAdd = document.getElementById('admin-add');
            var addLink = document.getElementById('add-link');
            if (ui && token) {
                try {
                    var datos = JSON.parse(atob(token.split('.')[1]));
                    ui.textContent = ' ' + (datos.email || datos.username || '');
                    if (adminAdd) adminAdd.style.display = datos.role === 'admin' ? '' : 'none';
                    if (addLink) addLink.style.display = datos.role === 'admin' ? '' : 'none';
                } catch (e) { }
            }
            if (lb) {
                if (!token) lb.style.display = 'none';
                lb.addEventListener('click', function () {
                    localStorage.removeItem('token');
                    window.location.href = '/html/login.html';
                });
            }
            if (!token && adminAdd) adminAdd.style.display = 'none';
            if (!token && addLink) addLink.style.display = 'none';
        });
    </script>
</body>

</html>